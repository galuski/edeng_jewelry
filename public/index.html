<!doctype html>
<html lang="en">
  <head>
    <!-- Charset & Viewport -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Google Analytics (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9J44DC4J3J"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-9J44DC4J3J');
    </script>

    <!-- ✅ Content Security Policy -->
    <meta
      http-equiv="Content-Security-Policy"
      content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.userway.org https://userway.org https://www.googletagmanager.com;
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.userway.org;
        style-src-elem 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.userway.org;
        font-src 'self' data: https://fonts.gstatic.com https://cdn.userway.org;
        img-src 'self' data: blob: https://res.cloudinary.com https://cdn.userway.org https://www.google-analytics.com;
        connect-src 'self' http://localhost:3030 https://ypay.co.il https://api.userway.org https://cdn.userway.org https://api.cloudinary.com https://www.google-analytics.com https://analytics.google.com https://*.google-analytics.com https://*.analytics.google.com;
        frame-src 'self' https://userway.org https://cdn.userway.org;
      "
    >


    <!-- Accessibility widget (UserWay) -->
    <script>
      (function (d) {
        var s = d.createElement('script');
        s.setAttribute('data-account', 'ZohxEJRbTm');
        s.setAttribute('src', 'https://cdn.userway.org/widget.js');
        (d.body || d.head).appendChild(s);
      })(document);
    </script>

    <!-- SEO -->
    <meta
      name="description"
      content="Unique handmade jewelry, crafted with love and care. Discover one-of-a-kind designs for every occasion."
    />
    <meta
      name="keywords"
      content="handmade jewelry, unique jewelry, custom jewelry, earrings, necklaces, rings, bracelets"
    />
    <meta name="author" content="Edeng Gedj" />
    <meta name="robots" content="index, follow" />

    <!-- Open Graph / Facebook -->
    <meta property="og:title" content="Edeng Jewellery - Unique Handmade Jewelry" />
    <meta property="og:description" content="Discover one-of-a-kind, handmade jewelry designed to stand out." />
    <meta property="og:image" content="/flaier.jpeg" />
    <meta property="og:url" content="https://edengjewellery.com" />
    <meta property="og:type" content="website" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Edeng Jewellery - Unique Handmade Jewelry" />
    <meta name="twitter:description" content="Unique handmade jewelry, crafted with love and care." />
    <meta name="twitter:image" content="/flaier.jpeg" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/icon.png" />

    <title>Edeng Jewellery - Unique Handmade Jewelry</title>
    <script type="module" crossorigin src="/assets/index-Dk-KEYfz.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-C1DpCh_J.css">
  </head>

  <body>
    <div id="root"></div>
    <!-- Main React script -->

    <!-- E-commerce Analytics Events -->
    <script>
      (function() {
        // Helper: Extract product info from DOM element
        function getProductInfo(element) {
          const card = element.closest('.jewel-preview') || element.closest('[data-id]');
          if (!card) return null;

          const id = card.getAttribute('data-id') || '';
          const nameEl = card.querySelector('h3, h4, .title, [class*="name"], [class*="vendor"]');
          const priceEl = card.querySelector('[class*="price"]');

          return {
            item_id: id,
            item_name: nameEl ? nameEl.textContent.trim() : 'Unknown Product',
            price: priceEl ? parseFloat(priceEl.textContent.replace(/[^\d.]/g, '')) || 0 : 0,
            currency: 'ILS'
          };
        }

        // Helper: Get cart items from DOM
        function getCartItems() {
          const items = [];
          document.querySelectorAll('.cart-items > div, .cart-items tr').forEach(function(row) {
            const nameEl = row.querySelector('[class*="title"], [class*="name"], td:first-child');
            const priceEl = row.querySelector('[class*="price"]');
            if (nameEl) {
              items.push({
                item_name: nameEl.textContent.trim(),
                price: priceEl ? parseFloat(priceEl.textContent.replace(/[^\d.]/g, '')) || 0 : 0,
                currency: 'ILS',
                quantity: 1
              });
            }
          });
          return items;
        }

        // Helper: Get cart total
        function getCartTotal() {
          const totalEl = document.querySelector('.cart-total [class*="price"], .cart-total');
          if (totalEl) {
            const match = totalEl.textContent.match(/[\d,.]+/);
            return match ? parseFloat(match[0].replace(',', '')) : 0;
          }
          return 0;
        }

        // Track clicks using event delegation
        document.addEventListener('click', function(e) {
          const target = e.target;

          // Add to Cart
          if (target.closest('[class*="add-to-cart"], [class*="Add To Cart"], .shop-btn')) {
            const btn = target.closest('[class*="add-to-cart"], [class*="Add To Cart"], .shop-btn');
            if (btn && (btn.textContent.includes('Add') || btn.textContent.includes('הוסף'))) {
              const product = getProductInfo(btn);
              if (product) {
                gtag('event', 'add_to_cart', {
                  currency: 'ILS',
                  value: product.price,
                  items: [product]
                });
              }
            }
          }

          // Remove from Cart
          if (target.closest('.remove-cart-btn, [class*="remove"]')) {
            const btn = target.closest('.remove-cart-btn, [class*="remove"]');
            const product = getProductInfo(btn);
            gtag('event', 'remove_from_cart', {
              currency: 'ILS',
              value: product ? product.price : 0,
              items: product ? [product] : []
            });
          }

          // View Cart (click on cart icon)
          if (target.closest('.cart-icon-btn, .cart-icon')) {
            gtag('event', 'view_cart', {
              currency: 'ILS',
              value: getCartTotal(),
              items: getCartItems()
            });
          }

          // Begin Checkout
          if (target.closest('.cart-submit-btn, [class*="checkout"]')) {
            const btn = target.closest('.cart-submit-btn, [class*="checkout"]');
            if (btn && (btn.textContent.includes('CHECKOUT') || btn.textContent.includes('תשלום'))) {
              gtag('event', 'begin_checkout', {
                currency: 'ILS',
                value: getCartTotal(),
                items: getCartItems()
              });
            }
          }

          // View Product (click on product card)
          if (target.closest('.jewel-preview')) {
            const card = target.closest('.jewel-preview');
            // Don't track if clicking add to cart button
            if (!target.closest('[class*="add-to-cart"], .shop-btn')) {
              const product = getProductInfo(card);
              if (product) {
                gtag('event', 'view_item', {
                  currency: 'ILS',
                  value: product.price,
                  items: [product]
                });
              }
            }
          }

          // Contact Form Submit
          if (target.closest('[type="submit"], .send-message, [class*="submit"]')) {
            const form = target.closest('form');
            if (form && form.querySelector('[name*="message"], [class*="message"]')) {
              gtag('event', 'generate_lead', {
                currency: 'ILS'
              });
            }
          }
        });

        // Track successful purchase on success page
        if (window.location.pathname.includes('/order/success')) {
          var urlParams = new URLSearchParams(window.location.search);
          var txnId = urlParams.get('txn') || 'TXN_' + Date.now();
          var amount = parseFloat(urlParams.get('amount')) || 0;

          gtag('event', 'purchase', {
            transaction_id: txnId,
            currency: 'ILS',
            value: amount,
            items: []
          });
        }

        // Track failed payment
        if (window.location.pathname.includes('/order/failure')) {
          gtag('event', 'payment_failed', {
            currency: 'ILS'
          });
        }

        // Track page sections via scroll
        var trackedSections = {};
        var observer = new IntersectionObserver(function(entries) {
          entries.forEach(function(entry) {
            if (entry.isIntersecting && !trackedSections[entry.target.className]) {
              trackedSections[entry.target.className] = true;
              var sectionName = entry.target.className.split(' ')[0] || 'section';
              gtag('event', 'view_section', {
                section_name: sectionName
              });
            }
          });
        }, { threshold: 0.5 });

        // Observe main sections after DOM loads
        window.addEventListener('load', function() {
          document.querySelectorAll('.About, .jewel-list, .cart, .filter-container').forEach(function(section) {
            observer.observe(section);
          });
        });
      })();
    </script>
  </body>
</html>